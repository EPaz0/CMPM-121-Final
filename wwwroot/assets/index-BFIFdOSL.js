(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();const O={en:{title:"Fish Farm",shop:"Shop",tutorialObjective:"Tutorial Objective",objective:"Level {{level}} Objective",objectiveText:"Make üíµ {{amount}}",day:"Day",nextDay:"Next Day",buy:"Buy",sell:"Sell",fish:"Fish",noFishInCell:"No fish in this cell.",cell:"Cell",sunlight:"‚òÄÔ∏è Sunlight",food:"üçé Food",growth:"Growth",value:"Value",wonText:"You won in {{days}} days!",loseText:"Game Over!",gameWon:"Congratulations! You completed the game!",saveGame:"Save Game",loadGame:"Load Game",listSaveSlots:"List Save Slots",deleteSaveSlot:"Delete Save Slot",savePrompt:"Enter save slot name to save to (e.g., Slot1):",loadPrompt:"Enter save slot name to load from (e.g., Slot1):",deletePrompt:"Enter save slot name to delete (e.g., Slot1):",noSaveData:'No save data found for slot "{{slot}}".',gameLoaded:'Game loaded from slot "{{slot}}".',slotDeleted:'Save slot "{{slot}}" deleted.',availableSlots:`Available save slots:
{{slots}}`,Red:"Red",Green:"Green",Yellow:"Yellow"},es:{title:"Granja de Peces",shop:"Tienda",tutorialObjective:"Objetivo del Tutorial",objective:"Objetivo de Nivel {{level}}",objectiveText:"Consigue üíµ {{amount}}",day:"D√≠a",nextDay:"Siguiente D√≠a",buy:"Comprar",sell:"Vender",fish:"Pez",noFishInCell:"No hay peces en esta celda.",cell:"Celda",sunlight:"‚òÄÔ∏è Sol",food:"üçé Alimento",growth:"Crecimiento",value:"Valor",wonText:"¬°Ganaste en {{days}} d√≠as!",loseText:"¬°Fin del juego!",gameWon:"¬°Felicidades! ¬°Has completado el juego!",saveGame:"Guardar Partida",loadGame:"Cargar Partida",listSaveSlots:"Mostrar Ranuras Guardadas",deleteSaveSlot:"Eliminar Ranura Guardada",savePrompt:"Introduce el nombre de la ranura para guardar (por ejemplo: Slot1):",loadPrompt:"Introduce el nombre de la ranura para cargar (por ejemplo: Slot1):",deletePrompt:"Introduce el nombre de la ranura para eliminar (por ejemplo: Slot1):",noSaveData:'No se encontraron datos guardados para la ranura "{{slot}}".',gameLoaded:'Juego cargado desde la ranura "{{slot}}".',slotDeleted:'La ranura guardada "{{slot}}" ha sido eliminada.',availableSlots:`Ranuras guardadas disponibles:
{{slots}}`,Red:"Rojo",Green:"Verde",Yellow:"Amarillo"},ar:{title:"ŸÖÿ≤ÿ±ÿπÿ© ÿßŸÑÿ£ÿ≥ŸÖÿßŸÉ",shop:"ÿßŸÑŸÖÿ™ÿ¨ÿ±",tutorialObjective:"ŸáÿØŸÅ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸä",objective:"{{level}} ÿßŸÑŸáÿØŸÅ ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ",objectiveText:"ÿßŸÉÿ≥ÿ® üíµ {{amount}}",day:"ŸäŸàŸÖ",nextDay:"ÿßŸÑŸäŸàŸÖ ÿßŸÑÿ™ÿßŸÑŸä",buy:"ÿ¥ÿ±ÿßÿ°",sell:"ÿ®Ÿäÿπ",fish:"ÿ≥ŸÖŸÉÿ©",noFishInCell:"ŸÑÿß ŸäŸàÿ¨ÿØ ÿ£ÿ≥ŸÖÿßŸÉ ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑÿÆŸÑŸäÿ©.",cell:"ÿÆŸÑŸäÿ©",sunlight:"‚òÄÔ∏è ÿßŸÑÿ¥ŸÖÿ≥",food:"üçé ÿßŸÑÿ∑ÿπÿßŸÖ",growth:"ÿßŸÑŸÜŸÖŸà",value:"ÿßŸÑŸÇŸäŸÖÿ©",wonText:"ŸÅÿ≤ÿ™ ŸÅŸä {{days}} ŸäŸàŸÖŸãÿß!",loseText:"ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÑÿπÿ®ÿ©!",gameWon:"ŸÖÿ®ÿ±ŸàŸÉ! ŸÑŸÇÿØ ÿ£ŸÉŸÖŸÑÿ™ ÿßŸÑŸÑÿπÿ®ÿ©!",saveGame:"ÿ≠ŸÅÿ∏ ÿßŸÑŸÑÿπÿ®ÿ©",loadGame:"ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ©",listSaveSlots:"ÿπÿ±ÿ∂ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑÿ≠ŸÅÿ∏",deleteSaveSlot:"ÿ≠ÿ∞ŸÅ ŸÖŸÑŸÅ ÿßŸÑÿ≠ŸÅÿ∏",savePrompt:"ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿÆÿßŸÜÿ© ÿßŸÑÿ≠ŸÅÿ∏ (ŸÖÿ´ÿßŸÑ: Slot1):",loadPrompt:"ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿÆÿßŸÜÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ (ŸÖÿ´ÿßŸÑ: Slot1):",deletePrompt:"ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿÆÿßŸÜÿ© ÿßŸÑÿ≠ÿ∞ŸÅ (ŸÖÿ´ÿßŸÑ: Slot1):",noSaveData:'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿÆÿßŸÜÿ© "{{slot}}".',gameLoaded:'ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ© ŸÖŸÜ ÿßŸÑÿÆÿßŸÜÿ© "{{slot}}".',slotDeleted:'ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿÆÿßŸÜÿ© ÿßŸÑÿ≠ŸÅÿ∏ "{{slot}}".',availableSlots:`ÿÆÿßŸÜÿßÿ™ ÿßŸÑÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ™ŸàŸÅÿ±ÿ©:
{{slots}}`,Red:"ÿ£ÿ≠ŸÖÿ±",Green:"ÿ£ÿÆÿ∂ÿ±",Yellow:"ÿ£ÿµŸÅÿ±"}};let F="en";function L(o){o in O?F=o:(console.warn(`Language "${o}" is not available. Defaulting to English.`),F="en")}function n(o,e={}){const t=O[F][o];return W(t,e)}function W(o,e){return o.replace(/{{(\w+)}}/g,(t,s)=>{var a;return((a=e[s])==null?void 0:a.toString())??""})}const B=1e4,Y=30,V=2,q=.2,X=.4,D=3,w=3,x=10,b=10,J=5,K=2,R=10,U=10,c=150,y=10;function Z(o){const e=[],t=o.length;for(let s=0;s<t;s++){let a=o.charCodeAt(s);if(a>=55296&&a<=56319&&t>s+1){const i=o.charCodeAt(s+1);i>=56320&&i<=57343&&(a=(a-55296)*1024+i-56320+65536,s+=1)}if(a<128){e.push(a);continue}if(a<2048){e.push(a>>6|192),e.push(a&63|128);continue}if(a<55296||a>=57344&&a<65536){e.push(a>>12|224),e.push(a>>6&63|128),e.push(a&63|128);continue}if(a>=65536&&a<=1114111){e.push(a>>18|240),e.push(a>>12&63|128),e.push(a>>6&63|128),e.push(a&63|128);continue}e.push(239,191,189)}return new Uint8Array(e).buffer}function Q(o){return o^=o>>>16,o=Math.imul(o,2246822507),o^=o>>>13,o=Math.imul(o,3266489909),o^=o>>>16,o>>>0}const M=new Uint32Array([3432918353,461845907]);function G(o,e){return o<<e|o>>>32-e}function ee(o,e){const t=o.byteLength/4|0,s=new Uint32Array(o,0,t);for(let a=0;a<t;a++)s[a]=Math.imul(s[a],M[0]),s[a]=G(s[a],15),s[a]=Math.imul(s[a],M[1]),e[0]=e[0]^s[a],e[0]=G(e[0],13),e[0]=Math.imul(e[0],5)+3864292196}function te(o,e){const t=o.byteLength/4|0,s=o.byteLength%4;let a=0;const i=new Uint8Array(o,t*4,s);switch(s){case 3:a=a^i[2]<<16;case 2:a=a^i[1]<<8;case 1:a=a^i[0]<<0,a=Math.imul(a,M[0]),a=G(a,15),a=Math.imul(a,M[1]),e[0]=e[0]^a}}function oe(o,e){e[0]=e[0]^o.byteLength,e[0]=Q(e[0])}function ae(o,e){if(e=e?e|0:0,typeof o=="string"&&(o=Z(o)),!(o instanceof ArrayBuffer))throw new TypeError("Expected key to be ArrayBuffer or string");const t=new Uint32Array([e]);return ee(o,t),te(o,t),oe(o,t),t.buffer}function _(o){return new DataView(ae(o)).getUint32(0)%1073741824/1073741824}function g(o){const e=document.createElement("button");return e.innerHTML=o.text,o.div.append(e),e.addEventListener("click",o.onClick),e}function u(o){const e=document.createElement(o.size);return e.innerHTML=o.text,o.div.append(e),e}function m(o,e,t){if(e&&t){const s=Math.ceil(e),a=Math.floor(t);return Math.floor(_(o.toString())*(a-s+1)+s)}else return _(o.toString())}function se(o){return`
${n(o.type.name)} ${n("fish")} | ${n("growth")}: ${o.growth}/${x}, ${n("food")}: ${o.food}/${D}, ${n("value")}: ${o.value}`}const ie=[function(e){e.name("Green"),e.cost(15),e.growthMultiplier(1),e.minValueGain(1),e.growsWhen(({fish:t,cell:s})=>t.growth<w?!0:s.population.filter(i=>i!==t).filter(i=>i.type===t.type).length>2&&s.state.sunlight<8)},function(e){e.name("Yellow"),e.cost(30),e.growthMultiplier(.75),e.minValueGain(2),e.growsWhen(({fish:t,cell:s})=>t.growth<w?!0:s.population.filter(i=>i!==t).filter(i=>i.type!==t.type).length>2&&s.state.sunlight>=7)},function(e){e.name("Red"),e.cost(45),e.growthMultiplier(.5),e.minValueGain(3),e.growsWhen(({fish:t,cell:s})=>t.growth<w?!0:s.population.filter(i=>i!==t).filter(i=>i.type===t.type).length==0&&s.state.sunlight<5)}];class ne{constructor(){this.name="Green",this.cost=0,this.growthMultiplier=0,this.minValueGain=0,this.grow=e=>e.fish.growth}eat(e){if(e.cell.state.food>0)e.fish.food=Math.min(D,e.fish.food+1),e.cell.state.food--;else if(e.fish.food-=1,e.fish.food<0){const t=e.cell.population.indexOf(e.fish);e.cell.population.splice(t,1)}}calculateValue(e,t,s){for(let a=0;a<e.fish.growth-s;a++)e.fish.value+=m([e.cell.state.food,e.cell.population.length,t.currState.day,a,t.currSave.seed,"value"],e.fish.type.minValueGain,e.fish.type.minValueGain+V)}}function re(o){const e=new ne;return o({name(s){e.name=s},cost(s){e.cost=s},growthMultiplier(s){e.growthMultiplier=s},minValueGain(s){e.minValueGain=s},growsWhen(s){e.grow=a=>{const i=a.cell.population.length-J,l=i>0?Math.max(0,x-i*K):x,S=e.growthMultiplier,I=a.fish.growth;let p=0;return I<l&&(p=a.fish.growth+a.fish.food*S,p=Math.min(l,p)),p==0?a.fish.growth:a.fish.growth+(s(a)?p:0)}}}),e}const T=ie.map(re);function C(o,e){const t=[];for(let s=0;s<o.population.length;s++){const a=o.population[s];a.type.name==e&&a.growth>=w&&t.push(o.population[s])}return t}function le(){return{sunlight:0,food:0}}function ce(){return{state:le(),population:[]}}class de{constructor(e,t){this.x=e,this.y=t,this.details=ce()}draw(e){e.lineWidth=4,e.strokeStyle="lightblue",e.fillStyle="lightcyan",e.strokeRect(this.x,this.y,c,c),e.fillRect(this.x,this.y,c,c),e.font="20px arial",e.lineWidth=1,e.strokeStyle="orange",e.strokeText(`‚òÄÔ∏è ${this.details.state.sunlight}`,this.x+10,this.y+30),e.strokeStyle="red",e.strokeText(`üçé ${this.details.state.food}`,this.x+10,this.y+50),e.strokeStyle="blue",e.strokeText(`üêü ${this.details.population.length}`,this.x+10,this.y+70)}updateSunlight(e,t){const s=m([this.x,this.y,e,t,"randchange"])<.5?-1:1,a=m([this.x,this.y,e,t,"realchange"])<X?0:s;this.details.state.sunlight=Math.max(1,Math.min(U,this.details.state.sunlight+a))}updateFood(){this.details.state.food=Math.min(R,this.details.state.food+this.details.state.sunlight)}updateFish(e){this.details.population.forEach(t=>{const s={fish:t,cell:this.details},a=t.growth;t.type.eat(s),t.type.grow(s),t.type.calculateValue(s,e,a)})}addFish(e,t){for(let s=0;s<t;s++){const a={type:e,growth:0,food:0,value:Math.floor(e.cost/2)};this.details.population.push(a)}}updatePopulation(e,t){if(this.details.population.length>=2&&this.details.state.food>0){const s=[];s.push(Math.floor(C(this.details,"Green").length/2)),s.push(Math.floor(C(this.details,"Yellow").length/2)),s.push(Math.floor(C(this.details,"Red").length/2));for(let a=0;a<s.length;a++)for(let i=0;i<s[a];i++)m([this.x,this.y,a,i,e,t,"reproduction"])<q&&this.details.population.length<b&&this.addFish(T[a],1)}}removeFish(e){const t=this.details.population.indexOf(e);this.details.population.splice(t,1)}}function ue(){return Math.floor(Math.random()*B+1)}class A{constructor(e){this.seed=ue(),this.rows=e.rows,this.cols=e.cols,this.cells=Array.from({length:this.rows},(a,i)=>Array.from({length:this.cols},(l,S)=>new de(S*c+y/2,i*c+y/2)));const t=3+b*4,s=new ArrayBuffer(this.rows*this.cols*t);this.state=new Uint8Array(s)}draw(e){this.cells.forEach(t=>t.forEach(s=>{s.draw(e)}))}setInitialCellStats(){this.cells.forEach(e=>e.forEach(t=>{t.details.state.sunlight=m([t.x,t.y,this.seed,"sun"],1,U),t.details.state.food=m([t.x,t.y,this.seed,"food"],1,R)})),this.encode()}encode(){let e=0;for(let t=0;t<this.rows;t++)for(let s=0;s<this.cols;s++){const a=this.cells[t][s];this.state[e++]=a.details.state.sunlight,this.state[e++]=a.details.state.food,this.state[e++]=a.details.population.length;for(let i=0;i<b;i++)if(i<a.details.population.length){const l=a.details.population[i];this.state[e++]=l.type.name==="Green"?0:l.type.name==="Yellow"?1:2,this.state[e++]=l.growth,this.state[e++]=l.food,this.state[e++]=l.value}else this.state[e++]=0,this.state[e++]=0,this.state[e++]=0,this.state[e++]=0}}decode(){let e=0;for(let t=0;t<this.rows;t++)for(let s=0;s<this.cols;s++){const a=this.cells[t][s];a.details.state.sunlight=this.state[e++],a.details.state.food=this.state[e++];const i=this.state[e++];a.details.population=[];for(let l=0;l<i;l++){const S=this.state[e++],I=T[S],p=this.state[e++],N=this.state[e++],z=this.state[e++];a.details.population.push({type:I,growth:p,food:N,value:z})}e+=(b-i)*4}}}class he{constructor(){this.coords={row:0,col:0}}draw(e){const t=this.coords.col*c+y/2,s=this.coords.row*c+y/2;e.strokeStyle="limegreen",e.lineWidth=8,e.strokeRect(t,s,c,c)}move(e,t){this.coords.row=e,this.coords.col=t}}function pe(){const o=document.createElement("div");return o.style.position="absolute",o.style.backgroundColor="white",o.style.border="1px solid black",o.style.padding="10px",o.style.display="none",document.body.append(o),o}function ge(o,e){for(let t=0;t<o.availableFishTypes.length;t++)if(o.availableFishTypes[t]==e)return!0;return!1}class fe{constructor(e){this.gameManager=e,this.popup=pe()}updateHeader(){const e=document.querySelector("#header");e.innerHTML="",u({text:n("title"),div:e,size:"h1"});const t=u({text:`${n("day")} ${this.gameManager.currState.day}`,div:e,size:"h3"});t.style.display="inline",t.style.marginRight="20px",g({text:n("nextDay"),div:e,onClick:()=>{this.gameManager.nextDay()}});const s=u({text:`üíµ ${this.gameManager.currState.money}`,div:e,size:"h2"});s.style.display="inline";const a=u({text:"Special Event: None",div:e,size:"h3"});a.style.marginBottom="0px"}updateMoneyUI(e){const t=document.querySelector("#header h2");t&&(t.textContent=`üíµ ${e}`)}updateDayUI(e){const t=document.querySelector("#header h3");t&&(t.textContent=`${n("day")} ${e}`)}updateObjectiveUI(){const e=document.querySelector("#objectives");if(e.innerHTML="",u({text:this.gameManager.currState.scenarioIndex==0?n("tutorialObjective"):n("objective",{level:this.gameManager.currState.scenarioIndex}),div:e,size:"h2"}),u({text:this.gameManager.currState.won?`<strike>${n("objectiveText",{amount:this.gameManager.scenario.objectiveMoney})}</strike> ${n("wonText",{days:this.gameManager.currState.dayWon})}`:n("objectiveText",{amount:this.gameManager.scenario.objectiveMoney}),div:e,size:"h4"}),this.gameManager.currState.won&&this.gameManager.currState.scenarioIndex<f.length-1){const t=document.querySelector("#objectives");g({text:"Next Level",div:t,onClick:()=>{this.gameManager.nextScenario(),this.gameManager.autoSave(!0)}})}else this.gameManager.currState.won&&this.gameManager.currState.scenarioIndex>=f.length-1&&u({text:n("gameWon"),div:e,size:"h3"})}updateInfoUI(e){const t=document.getElementById("cell-info");t&&(t.innerText=`${n("cell")} (${this.gameManager.player.coords.row}, ${this.gameManager.player.coords.col})
      ${n("sunlight")}: ${e.details.state.sunlight}
      ${n("food")}: ${e.details.state.food}
      ${n("fish")}: ${e.details.population.length}`,e.details.population.length>0&&e.details.population.forEach(s=>{const a=`${n(s.type.name)} ${n("fish")} | ${n("growth")}: ${s.growth}/${x}, ${n("food")}: ${s.food}/${D}, ${n("value")}: ${s.value}`;t.innerText+=`
${a}`}))}updatePopupUI(e){this.popup.innerHTML="",e.details.population.length>0?e.details.population.forEach(t=>{u({text:se(t),div:this.popup,size:"h5"}),g({text:n("sell"),div:this.popup,onClick:()=>{this.gameManager.sellFish(e,t)}})}):u({text:n("noFishInCell"),div:this.popup,size:"h5"})}createFishButton(e,t,s){const a=u({text:`üíµ ${s.cost}`,div:t,size:"h5"});g({text:`${n("buy")} ${n(s.name)} ${n("fish")}`,div:t,onClick:()=>{if(e.currState.money>=s.cost){e.changeMoney(-s.cost);const i=e.grid.cells[e.player.coords.row][e.player.coords.col];i.addFish(s,1),this.updateInfoUI(i),e.autoSave(!0)}}}).append(a)}createShop(){const e=document.querySelector("#shop");e.innerHTML="",u({text:n("shop"),div:e,size:"h2"}),T.forEach(t=>{ge(this.gameManager.scenario,t.name)&&this.createFishButton(this.gameManager,e,t)})}updateGameUI(){this.updateHeader(),this.createShop(),this.gameManager.updateObjective()}}const me={grid_size:[2,3],available_fish_types:["Green"],objective:250},ye={grid_size:[3,4],available_fish_types:["Green","Yellow"],objective:1e3,special_events:[[5,"heatwave",4],[12,"baby_boom",3]]},Se={grid_size:[4,5],available_fish_types:["Green","Yellow","Red"],objective:5e3,special_events:[[3,"storm",4],[8,"heatwave",3],[15,"parasite_outbreak",4],[24,"baby_boom",3]]},k={tutorial:me,level1:ye,level2:Se},f=[];for(const o in k)f.push(k[o]);function j(o){const e=f[o].objective,t={rows:f[o].grid_size[0],cols:f[o].grid_size[1]},s=f[o].available_fish_types.slice();return{objectiveMoney:e,gridSize:t,availableFishTypes:s}}function $(o,e,t,s){return{day:t??0,money:s??Y,won:!1,dayWon:0,gridState:Array.from(o.state),scenarioIndex:e}}class ve{constructor(){this.scenario=j(0),this.grid=new A(this.scenario.gridSize),this.grid.setInitialCellStats(),this.player=new he,this.clickedCell=this.grid.cells[0][0],this.currSave={seed:this.grid.seed,gameStates:[]},this.currState=$(this.grid,0),this.redoStates=[],this.uiManager=new fe(this)}setScenario(){this.scenario=j(this.currState.scenarioIndex),this.grid=new A(this.scenario.gridSize),this.grid.seed=this.currSave.seed,this.grid.setInitialCellStats(),this.currState=$(this.grid,this.currState.scenarioIndex,this.currState.day,this.currState.money),this.clickedCell=this.grid.cells[0][0],this.player.move(0,0),this.uiManager.popup.style.display="none",this.uiManager.updateGameUI()}nextScenario(){this.currState.scenarioIndex++,this.setScenario()}restoreGameState(e){this.currState.day=e.day,this.currState.money=e.money,this.currState.won=e.won,this.currState.dayWon=e.dayWon,this.currState.scenarioIndex=e.scenarioIndex,this.setScenario(),this.grid.state.set(e.gridState),this.grid.decode()}restoreGameSave(e){this.grid.seed=e.seed,this.currSave.seed=e.seed,this.currSave.gameStates=e.gameStates.map(s=>({day:s.day,money:s.money,won:s.won,dayWon:s.dayWon,gridState:s.gridState,scenarioIndex:s.scenarioIndex}));const t=this.currSave.gameStates[this.currSave.gameStates.length-1];this.currState={day:t.day,money:t.money,won:t.won,dayWon:t.dayWon,gridState:t.gridState,scenarioIndex:t.scenarioIndex},this.restoreGameState(this.currState)}saveToSlot(e){localStorage.setItem(`FishFarm_${e}`,JSON.stringify(this.currSave)),e!=="AutoSave"&&alert(`Game saved to slot "${e}".`)}autoSave(e){this.grid.encode();const t={day:this.currState.day,money:this.currState.money,won:this.currState.won,dayWon:this.currState.dayWon,gridState:Array.from(this.grid.state),scenarioIndex:this.currState.scenarioIndex};this.currSave.gameStates.push(t),this.saveToSlot("AutoSave"),e&&(this.redoStates=[])}loadFromSlot(e){const t=localStorage.getItem(`FishFarm_${e}`);if(!t){alert(n("noSaveData",{slot:e}));return}const s=JSON.parse(t);this.restoreGameSave(s),alert(n("gameLoaded",{slot:e}))}deleteSlot(e){localStorage.getItem(`FishFarm_${e}`)?(localStorage.removeItem(`FishFarm_${e}`),alert(n("slotDeleted",{slot:e}))):alert(n("noSaveData",{slot:e}))}displaySaveSlots(){const t=Object.keys(localStorage).filter(s=>s.startsWith("FishFarm_")).map(s=>s.replace("FishFarm_","")).join(", ");alert(n("availableSlots",{slots:t}))}undo(){if(this.currSave.gameStates.length>1){const e=this.currSave.gameStates.pop();this.redoStates.push(e);const t=this.currSave.gameStates.pop();this.restoreGameState(t),this.autoSave(!1)}}redo(){if(this.redoStates.length>0){const e=this.redoStates.pop();this.restoreGameState(e),this.autoSave(!1)}}nextDay(){this.grid.cells.forEach(e=>e.forEach(t=>{t.updateFood(),t.updateFish(this),t.updatePopulation(this.currState.day,this.currSave.seed),t.updateSunlight(this.currState.day,this.currSave.seed),this.uiManager.updateInfoUI(t)})),this.currState.day++,this.uiManager.updateDayUI(this.currState.day),this.autoSave(!0)}updateObjective(){this.currState.money>=this.scenario.objectiveMoney&&!this.currState.won&&(this.currState.won=!0,this.currState.dayWon=this.currState.day),this.uiManager.updateObjectiveUI()}changeMoney(e){this.currState.money+=e,this.uiManager.updateMoneyUI(this.currState.money),this.updateObjective()}sellFish(e,t){this.changeMoney(t.value),e.removeFish(t),this.uiManager.updateInfoUI(e),this.autoSave(!0)}}const h=document.getElementById("gameCanvas"),v=h.getContext("2d"),r=new ve;function P(){h.width=r.grid.cols*c+y,h.height=r.grid.rows*c+y,v&&(v.clearRect(0,0,h.width,h.height),r.grid.draw(v),r.player.draw(v),requestAnimationFrame(P))}P();document.addEventListener("click",o=>{const e=o.target;e!=h&&e.tagName!="BUTTON"&&e.tagName!="H5"?r.uiManager.popup.style.display="none":r.uiManager.updatePopupUI(r.clickedCell)});localStorage.getItem("FishFarm_AutoSave")?confirm("Do you want to load the autosave?")?r.loadFromSlot("AutoSave"):alert("Starting a new game. Autosave will overwrite existing autosave."):(alert("No autosave found. Starting a new game."),r.autoSave(!1));function we(o,e){let t=o.player.coords.row,s=o.player.coords.col;switch(e.key){case"ArrowRight":case"d":case"D":s+=1;break;case"ArrowLeft":case"a":case"A":s-=1;break;case"ArrowUp":case"w":case"W":t-=1;break;case"ArrowDown":case"s":case"S":t+=1;break}t>=0&&t<o.grid.rows&&s>=0&&s<o.grid.cols&&o.player.move(t,s);const a=o.grid.cells[t][s];o.uiManager.updateInfoUI(a),o.uiManager.popup.style.display="none"}document.addEventListener("keydown",o=>{we(r,o)});h.addEventListener("click",o=>{const e=h.getBoundingClientRect(),t=o.x-e.left,s=o.y-e.top,a=Math.floor(t/c),i=Math.floor(s/c);r.clickedCell=r.grid.cells[i][a],r.player.move(i,a),r.uiManager.updateInfoUI(r.clickedCell),r.uiManager.updatePopupUI(r.clickedCell),r.uiManager.popup.style.left=`${o.x+10}px`,r.uiManager.popup.style.top=`${o.y+10}px`,r.uiManager.popup.style.display="block"});const d=document.createElement("div");d.style.position="absolute";d.style.top="10px";d.style.right="10px";d.style.display="flex";d.style.flexDirection="row";d.style.gap="10px";document.body.appendChild(d);g({text:"‚Ü©Ô∏è",div:d,onClick:()=>{r.undo()}});g({text:"‚Ü™Ô∏è",div:d,onClick:()=>{r.redo()}});const H=[{key:"saveGame",text:n("saveGame"),div:d,onClick:()=>{const o=prompt(n("savePrompt"));o&&r.saveToSlot(o)}},{key:"loadGame",text:n("loadGame"),div:d,onClick:()=>{const o=prompt(n("loadPrompt"));o&&r.loadFromSlot(o)}},{key:"listSaveSlots",text:n("listSaveSlots"),div:d,onClick:()=>{r.displaySaveSlots()}},{key:"deleteSaveSlot",text:n("deleteSaveSlot"),div:d,onClick:()=>{const o=prompt(n("deletePrompt"));o&&r.deleteSlot(o)}}],E=[];H.forEach(o=>{const e=g({text:o.text,div:o.div,onClick:o.onClick});E.push(e)});function be(){for(let o=0;o<E.length;o++)E[o].textContent=n(H[o].key)}function xe(){const o=document.createElement("select");[{code:"en",label:"English"},{code:"es",label:"Espa√±ol"},{code:"ar",label:"ÿßŸÑÿπÿ±ÿ®Ÿäÿ©"}].forEach(s=>{const a=document.createElement("option");a.value=s.code,a.textContent=s.label,o.appendChild(a)});const t=localStorage.getItem("language")||"en";o.value=t,L(t),r.uiManager.updateGameUI(),o.addEventListener("change",s=>{const a=s.target.value;L(a),localStorage.setItem("language",a),r.uiManager.updateGameUI(),be(),r.uiManager.createShop()}),document.body.prepend(o)}xe();
