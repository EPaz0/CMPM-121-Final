(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();function Z(t){const e=[],o=t.length;for(let a=0;a<o;a++){let s=t.charCodeAt(a);if(s>=55296&&s<=56319&&o>a+1){const n=t.charCodeAt(a+1);n>=56320&&n<=57343&&(s=(s-55296)*1024+n-56320+65536,a+=1)}if(s<128){e.push(s);continue}if(s<2048){e.push(s>>6|192),e.push(s&63|128);continue}if(s<55296||s>=57344&&s<65536){e.push(s>>12|224),e.push(s>>6&63|128),e.push(s&63|128);continue}if(s>=65536&&s<=1114111){e.push(s>>18|240),e.push(s>>12&63|128),e.push(s>>6&63|128),e.push(s&63|128);continue}e.push(239,191,189)}return new Uint8Array(e).buffer}function Q(t){return t^=t>>>16,t=Math.imul(t,2246822507),t^=t>>>13,t=Math.imul(t,3266489909),t^=t>>>16,t>>>0}const C=new Uint32Array([3432918353,461845907]);function I(t,e){return t<<e|t>>>32-e}function ee(t,e){const o=t.byteLength/4|0,a=new Uint32Array(t,0,o);for(let s=0;s<o;s++)a[s]=Math.imul(a[s],C[0]),a[s]=I(a[s],15),a[s]=Math.imul(a[s],C[1]),e[0]=e[0]^a[s],e[0]=I(e[0],13),e[0]=Math.imul(e[0],5)+3864292196}function te(t,e){const o=t.byteLength/4|0,a=t.byteLength%4;let s=0;const n=new Uint8Array(t,o*4,a);switch(a){case 3:s=s^n[2]<<16;case 2:s=s^n[1]<<8;case 1:s=s^n[0]<<0,s=Math.imul(s,C[0]),s=I(s,15),s=Math.imul(s,C[1]),e[0]=e[0]^s}}function oe(t,e){e[0]=e[0]^t.byteLength,e[0]=Q(e[0])}function ae(t,e){if(e=e?e|0:0,typeof t=="string"&&(t=Z(t)),!(t instanceof ArrayBuffer))throw new TypeError("Expected key to be ArrayBuffer or string");const o=new Uint32Array([e]);return ee(t,o),te(t,o),oe(t,o),o.buffer}function k(t){return new DataView(ae(t)).getUint32(0)%1073741824/1073741824}function m(t){const e=document.createElement("button");return e.innerHTML=t.text,t.div.append(e),e.addEventListener("click",t.onClick),e}function h(t){const e=document.createElement(t.size);return e.innerHTML=t.text,t.div.append(e),e}const R={en:{title:"Fish Farm",shop:"Shop",tutorialObjective:"Tutorial Objective",objective:"Level {{level}} Objective",objectiveText:"Make 💵 {{amount}}",day:"Day",nextDay:"Next Day",buy:"Buy",sell:"Sell",fish:"Fish",noFishInCell:"No fish in this cell.",cell:"Cell",sunlight:"☀️ Sunlight",food:"🍎 Food",growth:"Growth",value:"Value",wonText:"You won in {{days}} days!",loseText:"Game Over!",gameWon:"Congratulations! You completed the game!",saveGame:"Save Game",loadGame:"Load Game",listSaveSlots:"List Save Slots",deleteSaveSlot:"Delete Save Slot",savePrompt:"Enter save slot name to save to (e.g., Slot1):",loadPrompt:"Enter save slot name to load from (e.g., Slot1):",deletePrompt:"Enter save slot name to delete (e.g., Slot1):",noSaveData:'No save data found for slot "{{slot}}".',gameLoaded:'Game loaded from slot "{{slot}}".',slotDeleted:'Save slot "{{slot}}" deleted.',availableSlots:`Available save slots:
{{slots}}`,Red:"Red",Green:"Green",Yellow:"Yellow"},es:{title:"Granja de Peces",shop:"Tienda",tutorialObjective:"Objetivo del Tutorial",objective:"Objetivo de Nivel {{level}}",objectiveText:"Consigue 💵 {{amount}}",day:"Día",nextDay:"Siguiente Día",buy:"Comprar",sell:"Vender",fish:"Pez",noFishInCell:"No hay peces en esta celda.",cell:"Celda",sunlight:"☀️ Sol",food:"🍎 Alimento",growth:"Crecimiento",value:"Valor",wonText:"¡Ganaste en {{days}} días!",loseText:"¡Fin del juego!",gameWon:"¡Felicidades! ¡Has completado el juego!",saveGame:"Guardar Partida",loadGame:"Cargar Partida",listSaveSlots:"Mostrar Ranuras Guardadas",deleteSaveSlot:"Eliminar Ranura Guardada",savePrompt:"Introduce el nombre de la ranura para guardar (por ejemplo: Slot1):",loadPrompt:"Introduce el nombre de la ranura para cargar (por ejemplo: Slot1):",deletePrompt:"Introduce el nombre de la ranura para eliminar (por ejemplo: Slot1):",noSaveData:'No se encontraron datos guardados para la ranura "{{slot}}".',gameLoaded:'Juego cargado desde la ranura "{{slot}}".',slotDeleted:'La ranura guardada "{{slot}}" ha sido eliminada.',availableSlots:`Ranuras guardadas disponibles:
{{slots}}`,Red:"Rojo",Green:"Verde",Yellow:"Amarillo"},ar:{title:"مزرعة الأسماك",shop:"المتجر",tutorialObjective:"هدف البرنامج التعليمي",objective:"{{level}} الهدف من المستوى",objectiveText:"اكسب 💵 {{amount}}",day:"يوم",nextDay:"اليوم التالي",buy:"شراء",sell:"بيع",fish:"سمكة",noFishInCell:"لا يوجد أسماك في هذه الخلية.",cell:"خلية",sunlight:"☀️ الشمس",food:"🍎 الطعام",growth:"النمو",value:"القيمة",wonText:"فزت في {{days}} يومًا!",loseText:"انتهت اللعبة!",gameWon:"مبروك! لقد أكملت اللعبة!",saveGame:"حفظ اللعبة",loadGame:"تحميل اللعبة",listSaveSlots:"عرض ملفات الحفظ",deleteSaveSlot:"حذف ملف الحفظ",savePrompt:"أدخل اسم خانة الحفظ (مثال: Slot1):",loadPrompt:"أدخل اسم خانة التحميل (مثال: Slot1):",deletePrompt:"أدخل اسم خانة الحذف (مثال: Slot1):",noSaveData:'لا توجد بيانات حفظ في الخانة "{{slot}}".',gameLoaded:'تم تحميل اللعبة من الخانة "{{slot}}".',slotDeleted:'تم حذف خانة الحفظ "{{slot}}".',availableSlots:`خانات الحفظ المتوفرة:
{{slots}}`,Red:"أحمر",Green:"أخضر",Yellow:"أصفر"}};let D="en";function M(t){t in R?D=t:(console.warn(`Language "${t}" is not available. Defaulting to English.`),D="en")}function r(t,e={}){const o=R[D][t];return se(o,e)}function se(t,e){return t.replace(/{{(\w+)}}/g,(o,a)=>{var s;return((s=e[a])==null?void 0:s.toString())??""})}const ie={grid_size:[2,3],available_fish_types:["Green"],objective:250},re={grid_size:[3,4],available_fish_types:["Green","Yellow"],objective:1e3,special_events:[[5,"heatwave",4],[12,"baby_boom",3]]},ne={grid_size:[4,5],available_fish_types:["Green","Yellow","Red"],objective:5e3,special_events:[[3,"storm",4],[8,"heatwave",3],[15,"parasite_outbreak",4],[24,"baby_boom",3]]},N={tutorial:ie,level1:re,level2:ne},S=[];for(const t in N)S.push(N[t]);const le=1e4,ce=30,E=15,de=.2,ue=.4,L=3,x=10,b=10,he=5,pe=2,P=10,U=10,d=150,g=10;let G,$;const p=document.getElementById("gameCanvas"),w=p.getContext("2d"),l=document.createElement("div");l.style.position="absolute";l.style.backgroundColor="white";l.style.border="1px solid black";l.style.padding="10px";l.style.display="none";document.body.append(l);function Se(t){return`
${r(t.type.typeName)} ${r("fish")} | ${r("growth")}: ${t.growth}/${x}, ${r("food")}: ${t.food}/${L}, ${r("value")}: ${t.value}`}function z(t,e,o){for(let a=0;a<o;a++){const s={type:e,growth:0,food:0,value:Math.floor(e.cost/2)};t.population.push(s)}}function F(t,e){const o=[];for(let a=0;a<t.population.length;a++)t.population[a].type.typeName==e&&o.push(t.population[a]);return o}const T=[{typeName:"Green",cost:E,growthMultiplier:1,minValueGain:1,maxValueGain:3},{typeName:"Yellow",cost:E*2,growthMultiplier:.75,minValueGain:2,maxValueGain:4},{typeName:"Red",cost:E*3,growthMultiplier:.5,minValueGain:3,maxValueGain:5}];function y(t,e,o){if(e&&o){const a=Math.ceil(e),s=Math.floor(o);return Math.floor(k(t.toString())*(s-a+1)+a)}else return k(t.toString())}class me{constructor(e,o){this.x=e,this.y=o,this.sunlight=0,this.food=0,this.population=[]}draw(e){e.lineWidth=4,e.strokeStyle="lightblue",e.fillStyle="lightcyan",e.strokeRect(this.x,this.y,d,d),e.fillRect(this.x,this.y,d,d),e.font="20px arial",e.lineWidth=1,e.strokeStyle="orange",e.strokeText(`☀️ ${this.sunlight}`,this.x+10,this.y+30),e.strokeStyle="red",e.strokeText(`🍎 ${this.food}`,this.x+10,this.y+50),e.strokeStyle="blue",e.strokeText(`🐟 ${this.population.length}`,this.x+10,this.y+70)}updateSunlight(e,o){const a=y([this.x,this.y,e,o,"randchange"])<.5?-1:1,s=y([this.x,this.y,e,o,"realchange"])<ue?0:a;this.sunlight=Math.max(1,Math.min(U,this.sunlight+s))}updateFood(){this.food=Math.min(P,this.food+this.sunlight)}updateFishGrowth(e,o){this.population.forEach(a=>{if(this.food>0){a.food=Math.min(L,a.food+1),this.food--;const s=this.population.length-he,n=s>0?Math.max(0,x-s*pe):x,c=a.type.growthMultiplier,f=a.growth;f<n&&(a.growth+=a.food*c,a.growth=Math.min(n,a.growth));for(let v=0;v<a.growth-f;v++)a.value+=y([this.food,this.population.length,e,v,o,"value"],a.type.minValueGain,a.type.maxValueGain)}else if(a.food-=1,a.food<0){const s=this.population.indexOf(a);this.population.splice(s,1)}})}updatePopulation(e,o){if(this.population.length>=2&&this.food>0){const a=[];a.push(Math.floor(F(this,"Green").length/2)),a.push(Math.floor(F(this,"Yellow").length/2)),a.push(Math.floor(F(this,"Red").length/2));for(let s=0;s<a.length;s++)for(let n=0;n<a[s];n++)y([this.x,this.y,s,n,e,o,"reproduction"])<de&&this.population.length<b&&z(this,T[s],1)}}sellFish(e){Y(e.value);const o=this.population.indexOf(e);this.population.splice(o,1),this.updateInfoUI(),i.autoSave(!0)}updateInfoUI(){const e=document.getElementById("cell-info");e&&(e.innerText=`${r("cell")} (${i.player.coords.row}, ${i.player.coords.col})
      ${r("sunlight")}: ${this.sunlight}
      ${r("food")}: ${this.food}
      ${r("fish")}: ${this.population.length}`,this.population.length>0&&this.population.forEach(o=>{const a=`${r(o.type.typeName)} ${r("fish")} | ${r("growth")}: ${o.growth}/${x}, ${r("food")}: ${o.food}/${L}, ${r("value")}: ${o.value}`;e.innerText+=`
${a}`}))}updatePopupUI(){l.innerHTML="",this.population.length>0?this.population.forEach(e=>{h({text:Se(e),div:l,size:"h5"}),m({text:r("sell"),div:l,onClick:()=>{this.sellFish(e)}})}):h({text:r("noFishInCell"),div:l,size:"h5"})}}function fe(t){return Math.floor(Math.random()*t+1)}class j{constructor(e){this.seed=fe(le),this.rows=S[e].grid_size[0],this.cols=S[e].grid_size[1],this.cells=Array.from({length:this.rows},(s,n)=>Array.from({length:this.cols},(c,f)=>new me(f*d+g/2,n*d+g/2)));const o=3+b*4,a=new ArrayBuffer(this.rows*this.cols*o);this.state=new Uint8Array(a)}draw(e){this.cells.forEach(o=>o.forEach(a=>{a.draw(e)}))}setInitialCellStats(){this.cells.forEach(e=>e.forEach(o=>{o.sunlight=y([o.x,o.y,this.seed,"sun"],1,U),o.food=y([o.x,o.y,this.seed,"food"],1,P)})),this.encode()}encode(){let e=0;for(let o=0;o<this.rows;o++)for(let a=0;a<this.cols;a++){const s=this.cells[o][a];this.state[e++]=s.sunlight,this.state[e++]=s.food,this.state[e++]=s.population.length;for(let n=0;n<b;n++)if(n<s.population.length){const c=s.population[n];this.state[e++]=c.type.typeName==="Green"?0:c.type.typeName==="Yellow"?1:2,this.state[e++]=c.growth,this.state[e++]=c.food,this.state[e++]=c.value}else this.state[e++]=0,this.state[e++]=0,this.state[e++]=0,this.state[e++]=0}}decode(){let e=0;for(let o=0;o<this.rows;o++)for(let a=0;a<this.cols;a++){const s=this.cells[o][a];s.sunlight=this.state[e++],s.food=this.state[e++];const n=this.state[e++];s.population=[];for(let c=0;c<n;c++){const f=this.state[e++],v=T[f],X=this.state[e++],J=this.state[e++],K=this.state[e++];s.population.push({type:v,growth:X,food:J,value:K})}e+=(b-n)*4}}}function O(t,e,o,a){return{day:o??0,money:a??ce,won:!1,dayWon:0,gridState:Array.from(t.state),scenario:e}}class ye{constructor(){this.coords={row:0,col:0}}draw(e){const o=this.coords.col*d+g/2,a=this.coords.row*d+g/2;e.strokeStyle="limegreen",e.lineWidth=8,e.strokeRect(o,a,d,d)}move(e,o){this.coords.row=e,this.coords.col=o}}class ge{constructor(){this.grid=new j(0),this.grid.setInitialCellStats(),this.player=new ye,this.clickedCell=this.grid.cells[0][0],this.currSave={seed:this.grid.seed,gameStates:[]},this.currState=O(this.grid,0),this.redoStates=[]}setScenario(){this.grid=new j(this.currState.scenario),this.grid.seed=this.currSave.seed,this.grid.setInitialCellStats(),this.currState=O(this.grid,this.currState.scenario,this.currState.day,this.currState.money),G=S[this.currState.scenario].objective,$=S[this.currState.scenario].available_fish_types.slice(),this.clickedCell=this.grid.cells[0][0],this.player.move(0,0),l.style.display="none",A()}nextScenario(){this.currState.scenario++,this.setScenario()}restoreGameState(e){this.currState.day=e.day,this.currState.money=e.money,this.currState.won=e.won,this.currState.dayWon=e.dayWon,this.currState.scenario=e.scenario,this.setScenario(),this.grid.state.set(e.gridState),this.grid.decode()}restoreGameSave(e){this.grid.seed=e.seed,this.currSave.seed=e.seed,this.currSave.gameStates=e.gameStates.map(a=>({day:a.day,money:a.money,won:a.won,dayWon:a.dayWon,gridState:a.gridState,scenario:a.scenario}));const o=this.currSave.gameStates[this.currSave.gameStates.length-1];this.currState={day:o.day,money:o.money,won:o.won,dayWon:o.dayWon,gridState:o.gridState,scenario:o.scenario},this.restoreGameState(this.currState)}saveToSlot(e){localStorage.setItem(`FishFarm_${e}`,JSON.stringify(this.currSave)),e!=="AutoSave"&&alert(`Game saved to slot "${e}".`)}autoSave(e){this.grid.encode();const o={day:this.currState.day,money:this.currState.money,won:this.currState.won,dayWon:this.currState.dayWon,gridState:Array.from(this.grid.state),scenario:this.currState.scenario};this.currSave.gameStates.push(o),this.saveToSlot("AutoSave"),e&&(this.redoStates=[])}loadFromSlot(e){const o=localStorage.getItem(`FishFarm_${e}`);if(!o){alert(r("noSaveData",{slot:e}));return}const a=JSON.parse(o);this.restoreGameSave(a),alert(r("gameLoaded",{slot:e}))}deleteSlot(e){localStorage.getItem(`FishFarm_${e}`)?(localStorage.removeItem(`FishFarm_${e}`),alert(r("slotDeleted",{slot:e}))):alert(r("noSaveData",{slot:e}))}displaySaveSlots(){const o=Object.keys(localStorage).filter(a=>a.startsWith("FishFarm_")).map(a=>a.replace("FishFarm_","")).join(", ");alert(r("availableSlots",{slots:o}))}undo(){if(this.currSave.gameStates.length>1){const e=this.currSave.gameStates.pop();this.redoStates.push(e);const o=this.currSave.gameStates.pop();this.restoreGameState(o),this.autoSave(!1)}}redo(){if(this.redoStates.length>0){const e=this.redoStates.pop();this.restoreGameState(e),this.autoSave(!1)}}nextDay(){this.grid.cells.forEach(e=>e.forEach(o=>{o.updateFood(),o.updateFishGrowth(this.currState.day,this.currSave.seed),o.updatePopulation(this.currState.day,this.currSave.seed),o.updateSunlight(this.currState.day,this.currSave.seed),o.updateInfoUI()})),this.currState.day++,Fe(),this.autoSave(!0)}}function ve(t,e){let o=t.player.coords.row,a=t.player.coords.col;switch(e.key){case"ArrowRight":case"d":case"D":a+=1;break;case"ArrowLeft":case"a":case"A":a-=1;break;case"ArrowUp":case"w":case"W":o-=1;break;case"ArrowDown":case"s":case"S":o+=1;break}o>=0&&o<t.grid.rows&&a>=0&&a<t.grid.cols&&t.player.move(o,a),t.grid.cells[o][a].updateInfoUI(),l.style.display="none"}const i=new ge;i.setScenario();xe();document.addEventListener("keydown",t=>{ve(i,t)});function H(){p.width=i.grid.cols*d+g,p.height=i.grid.rows*d+g,w&&(w.clearRect(0,0,p.width,p.height),i.grid.draw(w),i.player.draw(w),requestAnimationFrame(H))}H();localStorage.getItem("FishFarm_AutoSave")?confirm("Do you want to load the autosave?")?i.loadFromSlot("AutoSave"):alert("Starting a new game. Autosave will overwrite existing autosave."):(alert("No autosave found. Starting a new game."),i.autoSave(!1));p.addEventListener("click",t=>{const e=p.getBoundingClientRect(),o=t.x-e.left,a=t.y-e.top,s=Math.floor(o/d),n=Math.floor(a/d);i.clickedCell=i.grid.cells[n][s],i.player.move(n,s),i.clickedCell.updateInfoUI(),i.clickedCell.updatePopupUI(),l.style.left=`${t.x+10}px`,l.style.top=`${t.y+10}px`,l.style.display="block"});document.addEventListener("click",t=>{const e=t.target;e!=p&&e.tagName!="BUTTON"&&e.tagName!="H5"?l.style.display="none":i.clickedCell.updatePopupUI()});const u=document.createElement("div");u.style.position="absolute";u.style.top="10px";u.style.right="10px";u.style.display="flex";u.style.flexDirection="row";u.style.gap="10px";document.body.appendChild(u);m({text:"↩️",div:u,onClick:()=>{i.undo()}});m({text:"↪️",div:u,onClick:()=>{i.redo()}});const W=[{key:"saveGame",text:r("saveGame"),div:u,onClick:()=>{const t=prompt(r("savePrompt"));t&&i.saveToSlot(t)}},{key:"loadGame",text:r("loadGame"),div:u,onClick:()=>{const t=prompt(r("loadPrompt"));t&&i.loadFromSlot(t)}},{key:"listSaveSlots",text:r("listSaveSlots"),div:u,onClick:()=>{i.displaySaveSlots()}},{key:"deleteSaveSlot",text:r("deleteSaveSlot"),div:u,onClick:()=>{const t=prompt(r("deletePrompt"));t&&i.deleteSlot(t)}}],_=[];W.forEach(t=>{const e=m({text:t.text,div:t.div,onClick:t.onClick});_.push(e)});function we(){for(let t=0;t<_.length;t++)_[t].textContent=r(W[t].key)}function xe(){const t=document.createElement("select");[{code:"en",label:"English"},{code:"es",label:"Español"},{code:"ar",label:"العربية"}].forEach(a=>{const s=document.createElement("option");s.value=a.code,s.textContent=a.label,t.appendChild(s)});const o=localStorage.getItem("language")||"en";t.value=o,M(o),A(),t.addEventListener("change",a=>{const s=a.target.value;M(s),localStorage.setItem("language",s),A(),we(),V()}),document.body.prepend(t)}function be(){const t=document.querySelector("#header");t.innerHTML="",h({text:r("title"),div:t,size:"h1"});const e=h({text:`${r("day")} ${i.currState.day}`,div:t,size:"h3"});e.style.display="inline",e.style.marginRight="20px",m({text:r("nextDay"),div:t,onClick:()=>{i.nextDay()}});const o=h({text:`💵 ${i.currState.money}`,div:t,size:"h2"});o.style.display="inline"}function Ce(){const t=document.querySelector("#objectives");if(t.innerHTML="",h({text:i.currState.scenario==0?r("tutorialObjective"):r("objective",{level:i.currState.scenario}),div:t,size:"h2"}),h({text:i.currState.won?`<strike>${r("objectiveText",{amount:G})}</strike> ${r("wonText",{days:i.currState.dayWon})}`:r("objectiveText",{amount:G}),div:t,size:"h4"}),i.currState.won&&i.currState.scenario<S.length-1){const e=document.querySelector("#objectives");m({text:"Next Level",div:e,onClick:()=>{i.nextScenario(),i.autoSave(!0)}})}else i.currState.won&&i.currState.scenario>=S.length-1&&h({text:r("gameWon"),div:t,size:"h3"})}function B(){i.currState.money>=G&&!i.currState.won&&(i.currState.won=!0,i.currState.dayWon=i.currState.day),Ce()}function Y(t){i.currState.money+=t,q(),B()}function Ge(t,e){const o=h({text:`💵 ${e.cost}`,div:t,size:"h5"});m({text:`${r("buy")} ${r(e.typeName)} ${r("fish")}`,div:t,onClick:()=>{if(i.currState.money>=e.cost){Y(-e.cost),q();const a=i.grid.cells[i.player.coords.row][i.player.coords.col];z(a,e,1),a.updateInfoUI(),i.autoSave(!0)}}}).append(o)}function Ee(t){for(let e=0;e<$.length;e++)if($[e]==t)return!0;return!1}function V(){const t=document.querySelector("#shop");t.innerHTML="",h({text:r("shop"),div:t,size:"h2"}),T.forEach(e=>{Ee(e.typeName)&&Ge(t,e)})}function q(){const t=document.querySelector("#header h2");t&&(t.textContent=`💵 ${i.currState.money}`)}function Fe(){const t=document.querySelector("#header h3");t&&(t.textContent=`${r("day")} ${i.currState.day}`)}function A(){be(),V(),B()}
