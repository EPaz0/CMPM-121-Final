(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();const O={en:{title:"Fish Farm",shop:"Shop",tutorialObjective:"Tutorial Objective",objective:"Level {{level}} Objective",objectiveText:"Make üíµ {{amount}}",day:"Day",nextDay:"Next Day",buy:"Buy",sell:"Sell",fish:"Fish",noFishInCell:"No fish in this cell.",cell:"Cell",sunlight:"‚òÄÔ∏è Sunlight",food:"üçé Food",growth:"Growth",value:"Value",wonText:"You won in {{days}} days!",loseText:"Game Over!",gameWon:"Congratulations! You completed the game!",saveGame:"Save Game",loadGame:"Load Game",listSaveSlots:"List Save Slots",deleteSaveSlot:"Delete Save Slot",savePrompt:"Enter save slot name to save to (e.g., Slot1):",loadPrompt:"Enter save slot name to load from (e.g., Slot1):",deletePrompt:"Enter save slot name to delete (e.g., Slot1):",noSaveData:'No save data found for slot "{{slot}}".',gameLoaded:'Game loaded from slot "{{slot}}".',slotDeleted:'Save slot "{{slot}}" deleted.',availableSlots:`Available save slots:
{{slots}}`,Red:"Red",Green:"Green",Yellow:"Yellow"},es:{title:"Granja de Peces",shop:"Tienda",tutorialObjective:"Objetivo del Tutorial",objective:"Objetivo de Nivel {{level}}",objectiveText:"Consigue üíµ {{amount}}",day:"D√≠a",nextDay:"Siguiente D√≠a",buy:"Comprar",sell:"Vender",fish:"Pez",noFishInCell:"No hay peces en esta celda.",cell:"Celda",sunlight:"‚òÄÔ∏è Sol",food:"üçé Alimento",growth:"Crecimiento",value:"Valor",wonText:"¬°Ganaste en {{days}} d√≠as!",loseText:"¬°Fin del juego!",gameWon:"¬°Felicidades! ¬°Has completado el juego!",saveGame:"Guardar Partida",loadGame:"Cargar Partida",listSaveSlots:"Mostrar Ranuras Guardadas",deleteSaveSlot:"Eliminar Ranura Guardada",savePrompt:"Introduce el nombre de la ranura para guardar (por ejemplo: Slot1):",loadPrompt:"Introduce el nombre de la ranura para cargar (por ejemplo: Slot1):",deletePrompt:"Introduce el nombre de la ranura para eliminar (por ejemplo: Slot1):",noSaveData:'No se encontraron datos guardados para la ranura "{{slot}}".',gameLoaded:'Juego cargado desde la ranura "{{slot}}".',slotDeleted:'La ranura guardada "{{slot}}" ha sido eliminada.',availableSlots:`Ranuras guardadas disponibles:
{{slots}}`,Red:"Rojo",Green:"Verde",Yellow:"Amarillo"},ar:{title:"ŸÖÿ≤ÿ±ÿπÿ© ÿßŸÑÿ£ÿ≥ŸÖÿßŸÉ",shop:"ÿßŸÑŸÖÿ™ÿ¨ÿ±",tutorialObjective:"ŸáÿØŸÅ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸä",objective:"{{level}} ÿßŸÑŸáÿØŸÅ ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ",objectiveText:"ÿßŸÉÿ≥ÿ® üíµ {{amount}}",day:"ŸäŸàŸÖ",nextDay:"ÿßŸÑŸäŸàŸÖ ÿßŸÑÿ™ÿßŸÑŸä",buy:"ÿ¥ÿ±ÿßÿ°",sell:"ÿ®Ÿäÿπ",fish:"ÿ≥ŸÖŸÉÿ©",noFishInCell:"ŸÑÿß ŸäŸàÿ¨ÿØ ÿ£ÿ≥ŸÖÿßŸÉ ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑÿÆŸÑŸäÿ©.",cell:"ÿÆŸÑŸäÿ©",sunlight:"‚òÄÔ∏è ÿßŸÑÿ¥ŸÖÿ≥",food:"üçé ÿßŸÑÿ∑ÿπÿßŸÖ",growth:"ÿßŸÑŸÜŸÖŸà",value:"ÿßŸÑŸÇŸäŸÖÿ©",wonText:"ŸÅÿ≤ÿ™ ŸÅŸä {{days}} ŸäŸàŸÖŸãÿß!",loseText:"ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÑÿπÿ®ÿ©!",gameWon:"ŸÖÿ®ÿ±ŸàŸÉ! ŸÑŸÇÿØ ÿ£ŸÉŸÖŸÑÿ™ ÿßŸÑŸÑÿπÿ®ÿ©!",saveGame:"ÿ≠ŸÅÿ∏ ÿßŸÑŸÑÿπÿ®ÿ©",loadGame:"ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ©",listSaveSlots:"ÿπÿ±ÿ∂ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑÿ≠ŸÅÿ∏",deleteSaveSlot:"ÿ≠ÿ∞ŸÅ ŸÖŸÑŸÅ ÿßŸÑÿ≠ŸÅÿ∏",savePrompt:"ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿÆÿßŸÜÿ© ÿßŸÑÿ≠ŸÅÿ∏ (ŸÖÿ´ÿßŸÑ: Slot1):",loadPrompt:"ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿÆÿßŸÜÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ (ŸÖÿ´ÿßŸÑ: Slot1):",deletePrompt:"ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿÆÿßŸÜÿ© ÿßŸÑÿ≠ÿ∞ŸÅ (ŸÖÿ´ÿßŸÑ: Slot1):",noSaveData:'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿÆÿßŸÜÿ© "{{slot}}".',gameLoaded:'ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ© ŸÖŸÜ ÿßŸÑÿÆÿßŸÜÿ© "{{slot}}".',slotDeleted:'ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿÆÿßŸÜÿ© ÿßŸÑÿ≠ŸÅÿ∏ "{{slot}}".',availableSlots:`ÿÆÿßŸÜÿßÿ™ ÿßŸÑÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ™ŸàŸÅÿ±ÿ©:
{{slots}}`,Red:"ÿ£ÿ≠ŸÖÿ±",Green:"ÿ£ÿÆÿ∂ÿ±",Yellow:"ÿ£ÿµŸÅÿ±"}};let F="en";function L(a){a in O?F=a:(console.warn(`Language "${a}" is not available. Defaulting to English.`),F="en")}function r(a,e={}){const t=O[F][a];return $(t,e)}function $(a,e){return a.replace(/{{(\w+)}}/g,(t,s)=>{var o;return((o=e[s])==null?void 0:o.toString())??""})}const B=1e4,Y=30,V=2,q=.2,X=.4,R=3,w=3,G=10,b=10,J=5,K=2,P=10,H=10,c=150,y=10;function Z(a){const e=[],t=a.length;for(let s=0;s<t;s++){let o=a.charCodeAt(s);if(o>=55296&&o<=56319&&t>s+1){const i=a.charCodeAt(s+1);i>=56320&&i<=57343&&(o=(o-55296)*1024+i-56320+65536,s+=1)}if(o<128){e.push(o);continue}if(o<2048){e.push(o>>6|192),e.push(o&63|128);continue}if(o<55296||o>=57344&&o<65536){e.push(o>>12|224),e.push(o>>6&63|128),e.push(o&63|128);continue}if(o>=65536&&o<=1114111){e.push(o>>18|240),e.push(o>>12&63|128),e.push(o>>6&63|128),e.push(o&63|128);continue}e.push(239,191,189)}return new Uint8Array(e).buffer}function Q(a){return a^=a>>>16,a=Math.imul(a,2246822507),a^=a>>>13,a=Math.imul(a,3266489909),a^=a>>>16,a>>>0}const x=new Uint32Array([3432918353,461845907]);function I(a,e){return a<<e|a>>>32-e}function ee(a,e){const t=a.byteLength/4|0,s=new Uint32Array(a,0,t);for(let o=0;o<t;o++)s[o]=Math.imul(s[o],x[0]),s[o]=I(s[o],15),s[o]=Math.imul(s[o],x[1]),e[0]=e[0]^s[o],e[0]=I(e[0],13),e[0]=Math.imul(e[0],5)+3864292196}function te(a,e){const t=a.byteLength/4|0,s=a.byteLength%4;let o=0;const i=new Uint8Array(a,t*4,s);switch(s){case 3:o=o^i[2]<<16;case 2:o=o^i[1]<<8;case 1:o=o^i[0]<<0,o=Math.imul(o,x[0]),o=I(o,15),o=Math.imul(o,x[1]),e[0]=e[0]^o}}function ae(a,e){e[0]=e[0]^a.byteLength,e[0]=Q(e[0])}function oe(a,e){if(e=e?e|0:0,typeof a=="string"&&(a=Z(a)),!(a instanceof ArrayBuffer))throw new TypeError("Expected key to be ArrayBuffer or string");const t=new Uint32Array([e]);return ee(a,t),te(a,t),ae(a,t),t.buffer}function T(a){return new DataView(oe(a)).getUint32(0)%1073741824/1073741824}function g(a){const e=document.createElement("button");return e.innerHTML=a.text,a.div.append(e),e.addEventListener("click",a.onClick),e}function h(a){const e=document.createElement(a.size);return e.innerHTML=a.text,a.div.append(e),e}function f(a,e,t){if(e&&t){const s=Math.ceil(e),o=Math.floor(t);return Math.floor(T(a.toString())*(o-s+1)+s)}else return T(a.toString())}function se(a){return`
${r(a.type.name)} ${r("fish")} | ${r("growth")}: ${a.growth}/${G}, ${r("food")}: ${a.food}/${R}, ${r("value")}: ${a.value}`}const ie=[function(e){e.name("Green"),e.cost(15),e.growthMultiplier(1),e.minValueGain(1),e.growsWhen(({fish:t,cell:s})=>t.growth<w?!0:s.population.filter(i=>i!==t).filter(i=>i.type===t.type).length>=2&&s.state.sunlight<8)},function(e){e.name("Yellow"),e.cost(30),e.growthMultiplier(.75),e.minValueGain(2),e.growsWhen(({fish:t,cell:s})=>t.growth<w?!0:s.population.filter(i=>i!==t).filter(i=>i.type!==t.type).length>=2&&s.state.sunlight>=7)},function(e){e.name("Red"),e.cost(45),e.growthMultiplier(.5),e.minValueGain(3),e.growsWhen(({fish:t,cell:s})=>t.growth<w?!0:s.population.filter(i=>i!==t).filter(i=>i.type===t.type).length==0&&s.state.sunlight<5)}];class re{constructor(){this.name="Green",this.cost=0,this.growthMultiplier=0,this.minValueGain=0}eat(e){if(e.cell.state.food>0)e.fish.food=Math.min(R,e.fish.food+1),e.cell.state.food--;else if(e.fish.food-=1,e.fish.food<0){const t=e.cell.population.indexOf(e.fish);e.cell.population.splice(t,1)}}calculateValue(e,t,s){for(let o=0;o<e.fish.growth-s;o++)e.fish.value+=f([e.cell.state.food,e.cell.population.length,t.currState.day,o,t.currSave.seed,"value"],e.fish.type.minValueGain,e.fish.type.minValueGain+V)}}function ne(a){const e=new re;return a({name(s){e.name=s},cost(s){e.cost=s},growthMultiplier(s){e.growthMultiplier=s},minValueGain(s){e.minValueGain=s},growsWhen(s){e.grow=o=>{const i=o.cell.population.length-J,l=i>0?Math.max(0,G-i*K):G,S=e.growthMultiplier,M=o.fish.growth;let p=0;if(M<l&&(p=o.fish.growth+o.fish.food*S,p=Math.min(l,p)),p==0)return o.fish.growth;s(o)&&(o.fish.growth=Math.min(l,p))}}}),e}const D=ie.map(ne);function C(a,e){const t=[];for(let s=0;s<a.population.length;s++){const o=a.population[s];o.type.name==e&&o.growth>=w&&t.push(a.population[s])}return t}function le(){return{sunlight:0,food:0}}function ce(){return{state:le(),population:[]}}class de{constructor(e,t){this.x=e,this.y=t,this.details=ce()}draw(e){e.lineWidth=4,e.strokeStyle="lightblue",e.fillStyle="lightcyan",e.strokeRect(this.x,this.y,c,c),e.fillRect(this.x,this.y,c,c),e.font="20px arial",e.lineWidth=1,e.strokeStyle="orange",e.strokeText(`‚òÄÔ∏è ${this.details.state.sunlight}`,this.x+10,this.y+30),e.strokeStyle="red",e.strokeText(`üçé ${this.details.state.food}`,this.x+10,this.y+50),e.strokeStyle="blue",e.strokeText(`üêü ${this.details.population.length}`,this.x+10,this.y+70)}updateSunlight(e,t){const s=f([this.x,this.y,e,t,"randchange"])<.5?-1:1,o=f([this.x,this.y,e,t,"realchange"])<X?0:s;this.details.state.sunlight=Math.max(1,Math.min(H,this.details.state.sunlight+o))}updateFood(){this.details.state.food=Math.min(P,this.details.state.food+this.details.state.sunlight)}updateFish(e){this.details.population.forEach(t=>{const s={fish:t,cell:this.details},o=t.growth;t.type.eat(s),t.type.grow(s),t.type.calculateValue(s,e,o)})}addFish(e,t){for(let s=0;s<t;s++){const o={type:e,growth:0,food:0,value:Math.floor(e.cost/2)};this.details.population.push(o)}}updatePopulation(e,t){if(this.details.population.length>=2&&this.details.state.food>0){const s=[];s.push(Math.floor(C(this.details,"Green").length/2)),s.push(Math.floor(C(this.details,"Yellow").length/2)),s.push(Math.floor(C(this.details,"Red").length/2));for(let o=0;o<s.length;o++)for(let i=0;i<s[o];i++)f([this.x,this.y,o,i,e,t,"reproduction"])<q&&this.details.population.length<b&&this.addFish(D[o],1)}}removeFish(e){const t=this.details.population.indexOf(e);this.details.population.splice(t,1)}}function he(){return Math.floor(Math.random()*B+1)}class _{constructor(e){this.seed=he(),this.rows=e.rows,this.cols=e.cols,this.cells=Array.from({length:this.rows},(o,i)=>Array.from({length:this.cols},(l,S)=>new de(S*c+y/2,i*c+y/2)));const t=3+b*4,s=new ArrayBuffer(this.rows*this.cols*t);this.state=new Uint8Array(s)}draw(e){this.cells.forEach(t=>t.forEach(s=>{s.draw(e)}))}setInitialCellStats(){this.cells.forEach(e=>e.forEach(t=>{t.details.state.sunlight=f([t.x,t.y,this.seed,"sun"],1,H),t.details.state.food=f([t.x,t.y,this.seed,"food"],1,P)})),this.encode()}encode(){let e=0;for(let t=0;t<this.rows;t++)for(let s=0;s<this.cols;s++){const o=this.cells[t][s];this.state[e++]=o.details.state.sunlight,this.state[e++]=o.details.state.food,this.state[e++]=o.details.population.length;for(let i=0;i<b;i++)if(i<o.details.population.length){const l=o.details.population[i];this.state[e++]=l.type.name==="Green"?0:l.type.name==="Yellow"?1:2,this.state[e++]=l.growth,this.state[e++]=l.food,this.state[e++]=l.value}else this.state[e++]=0,this.state[e++]=0,this.state[e++]=0,this.state[e++]=0}}decode(){let e=0;for(let t=0;t<this.rows;t++)for(let s=0;s<this.cols;s++){const o=this.cells[t][s];o.details.state.sunlight=this.state[e++],o.details.state.food=this.state[e++];const i=this.state[e++];o.details.population=[];for(let l=0;l<i;l++){const S=this.state[e++],M=D[S],p=this.state[e++],W=this.state[e++],z=this.state[e++];o.details.population.push({type:M,growth:p,food:W,value:z})}e+=(b-i)*4}}}class ue{constructor(){this.coords={row:0,col:0}}draw(e){const t=this.coords.col*c+y/2,s=this.coords.row*c+y/2;e.strokeStyle="limegreen",e.lineWidth=8,e.strokeRect(t,s,c,c)}move(e,t){this.coords.row=e,this.coords.col=t}}function pe(){const a=document.createElement("div");return a.style.position="absolute",a.style.backgroundColor="white",a.style.border="1px solid black",a.style.padding="10px",a.style.display="none",document.body.append(a),a}function ge(a,e){for(let t=0;t<a.availableFishTypes.length;t++)if(a.availableFishTypes[t]==e)return!0;return!1}class me{constructor(e){this.gameManager=e,this.popup=pe()}updateHeader(){const e=document.querySelector("#header");e.innerHTML="",h({text:r("title"),div:e,size:"h1"});const t=h({text:`${r("day")} ${this.gameManager.currState.day}`,div:e,size:"h3"});t.style.display="inline",t.style.marginRight="20px",g({text:r("nextDay"),div:e,onClick:()=>{this.gameManager.nextDay()}});const s=h({text:`üíµ ${this.gameManager.currState.money}`,div:e,size:"h2"});s.style.display="inline";const o=h({text:"Special Event: None",div:e,size:"h3"});o.style.marginBottom="0px"}updateMoneyUI(e){const t=document.querySelector("#header h2");t&&(t.textContent=`üíµ ${e}`)}updateDayUI(e){const t=document.querySelector("#header h3");t&&(t.textContent=`${r("day")} ${e}`)}updateObjectiveUI(){const e=document.querySelector("#objectives");if(e.innerHTML="",h({text:this.gameManager.currState.scenarioIndex==0?r("tutorialObjective"):r("objective",{level:this.gameManager.currState.scenarioIndex}),div:e,size:"h2"}),h({text:this.gameManager.currState.won?`<strike>${r("objectiveText",{amount:this.gameManager.scenario.objectiveMoney})}</strike> ${r("wonText",{days:this.gameManager.currState.dayWon})}`:r("objectiveText",{amount:this.gameManager.scenario.objectiveMoney}),div:e,size:"h4"}),this.gameManager.currState.won&&this.gameManager.currState.scenarioIndex<m.length-1){const t=document.querySelector("#objectives");g({text:"Next Level",div:t,onClick:()=>{this.gameManager.nextScenario(),this.gameManager.autoSave(!0)}})}else this.gameManager.currState.won&&this.gameManager.currState.scenarioIndex>=m.length-1&&h({text:r("gameWon"),div:e,size:"h3"})}updatePopupUI(e){this.popup.innerHTML="",e.details.population.length>0?e.details.population.forEach(t=>{h({text:se(t),div:this.popup,size:"h5"}),g({text:r("sell"),div:this.popup,onClick:()=>{this.gameManager.sellFish(e,t)}})}):h({text:r("noFishInCell"),div:this.popup,size:"h5"})}createFishButton(e,t,s){const o=h({text:`üíµ ${s.cost}`,div:t,size:"h5"});g({text:`${r("buy")} ${r(s.name)} ${r("fish")}`,div:t,onClick:()=>{e.currState.money>=s.cost&&(e.changeMoney(-s.cost),e.grid.cells[e.player.coords.row][e.player.coords.col].addFish(s,1),e.autoSave(!0))}}).append(o)}createShop(){const e=document.querySelector("#shop");e.innerHTML="",h({text:r("shop"),div:e,size:"h2"}),D.forEach(t=>{ge(this.gameManager.scenario,t.name)&&this.createFishButton(this.gameManager,e,t)})}updateGameUI(){this.updateHeader(),this.createShop(),this.gameManager.updateObjective()}}const fe={grid_size:[2,3],available_fish_types:["Green"],objective:250},ye={grid_size:[3,4],available_fish_types:["Green","Yellow"],objective:1e3,special_events:[[5,"heatwave",4],[12,"baby_boom",3]]},Se={grid_size:[4,5],available_fish_types:["Green","Yellow","Red"],objective:5e3,special_events:[[3,"storm",4],[8,"heatwave",3],[15,"parasite_outbreak",4],[24,"baby_boom",3]]},A={tutorial:fe,level1:ye,level2:Se},m=[];for(const a in A)m.push(A[a]);function k(a){const e=m[a].objective,t={rows:m[a].grid_size[0],cols:m[a].grid_size[1]},s=m[a].available_fish_types.slice();return{index:a,objectiveMoney:e,gridSize:t,availableFishTypes:s}}function j(a,e,t,s){return{day:t??0,money:s??Y,won:!1,dayWon:0,gridState:Array.from(a.state),scenarioIndex:e}}class ve{constructor(){this.scenario=k(0),this.grid=new _(this.scenario.gridSize),this.grid.setInitialCellStats(),this.player=new ue,this.clickedCell=this.grid.cells[0][0],this.currSave={seed:this.grid.seed,gameStates:[]},this.currState=j(this.grid,0),this.redoStates=[],this.uiManager=new me(this)}setScenario(){this.scenario.index!=this.currState.scenarioIndex&&(this.scenario=k(this.currState.scenarioIndex),this.grid=new _(this.scenario.gridSize),this.clickedCell=this.grid.cells[0][0],this.player.move(0,0),this.uiManager.popup.style.display="none"),this.grid.seed=this.currSave.seed,this.grid.setInitialCellStats(),this.currState=j(this.grid,this.currState.scenarioIndex,this.currState.day,this.currState.money),this.uiManager.updateGameUI()}nextScenario(){this.currState.scenarioIndex++,this.setScenario()}restoreGameState(e){this.currState.day=e.day,this.currState.money=e.money,this.currState.won=e.won,this.currState.dayWon=e.dayWon,this.currState.scenarioIndex=e.scenarioIndex,this.setScenario(),this.grid.state.set(e.gridState),this.grid.decode()}restoreGameSave(e){this.grid.seed=e.seed,this.currSave.seed=e.seed,this.currSave.gameStates=e.gameStates.map(s=>({day:s.day,money:s.money,won:s.won,dayWon:s.dayWon,gridState:s.gridState,scenarioIndex:s.scenarioIndex}));const t=this.currSave.gameStates[this.currSave.gameStates.length-1];this.currState={day:t.day,money:t.money,won:t.won,dayWon:t.dayWon,gridState:t.gridState,scenarioIndex:t.scenarioIndex},this.restoreGameState(this.currState)}saveToSlot(e){localStorage.setItem(`FishFarm_${e}`,JSON.stringify(this.currSave)),e!=="AutoSave"&&alert(`Game saved to slot "${e}".`)}autoSave(e){this.grid.encode();const t={day:this.currState.day,money:this.currState.money,won:this.currState.won,dayWon:this.currState.dayWon,gridState:Array.from(this.grid.state),scenarioIndex:this.currState.scenarioIndex};this.currSave.gameStates.push(t),this.saveToSlot("AutoSave"),e&&(this.redoStates=[])}loadFromSlot(e){const t=localStorage.getItem(`FishFarm_${e}`);if(!t){alert(r("noSaveData",{slot:e}));return}const s=JSON.parse(t);this.restoreGameSave(s),alert(r("gameLoaded",{slot:e}))}deleteSlot(e){localStorage.getItem(`FishFarm_${e}`)?(localStorage.removeItem(`FishFarm_${e}`),alert(r("slotDeleted",{slot:e}))):alert(r("noSaveData",{slot:e}))}displaySaveSlots(){const t=Object.keys(localStorage).filter(s=>s.startsWith("FishFarm_")).map(s=>s.replace("FishFarm_","")).join(", ");alert(r("availableSlots",{slots:t}))}undo(){if(this.currSave.gameStates.length>1){const e=this.currSave.gameStates.pop();this.redoStates.push(e);const t=this.currSave.gameStates.pop();this.restoreGameState(t),this.autoSave(!1)}}redo(){if(this.redoStates.length>0){const e=this.redoStates.pop();this.restoreGameState(e),this.autoSave(!1)}}nextDay(){this.grid.cells.forEach(e=>e.forEach(t=>{t.updateFood(),t.updateFish(this),t.updatePopulation(this.currState.day,this.currSave.seed),t.updateSunlight(this.currState.day,this.currSave.seed)})),this.currState.day++,this.uiManager.updateDayUI(this.currState.day),this.autoSave(!0)}updateObjective(){this.currState.money>=this.scenario.objectiveMoney&&!this.currState.won&&(this.currState.won=!0,this.currState.dayWon=this.currState.day),this.uiManager.updateObjectiveUI()}changeMoney(e){this.currState.money+=e,this.uiManager.updateMoneyUI(this.currState.money),this.updateObjective()}sellFish(e,t){this.changeMoney(t.value),e.removeFish(t),this.autoSave(!0)}}const u=document.getElementById("gameCanvas"),v=u.getContext("2d"),n=new ve;function N(){u.width=n.grid.cols*c+y,u.height=n.grid.rows*c+y,v&&(v.clearRect(0,0,u.width,u.height),n.grid.draw(v),n.player.draw(v),requestAnimationFrame(N))}N();document.addEventListener("click",a=>{const e=a.target;e!=u&&e.tagName!="BUTTON"&&e.tagName!="H5"?n.uiManager.popup.style.display="none":n.uiManager.updatePopupUI(n.clickedCell)});localStorage.getItem("FishFarm_AutoSave")?confirm("Do you want to load the autosave?")?n.loadFromSlot("AutoSave"):alert("Starting a new game. Autosave will overwrite existing autosave."):(alert("No autosave found. Starting a new game."),n.autoSave(!1));function we(a,e){let t=a.player.coords.row,s=a.player.coords.col;switch(e.key){case"ArrowRight":case"d":case"D":s+=1;break;case"ArrowLeft":case"a":case"A":s-=1;break;case"ArrowUp":case"w":case"W":t-=1;break;case"ArrowDown":case"s":case"S":t+=1;break}t>=0&&t<a.grid.rows&&s>=0&&s<a.grid.cols&&a.player.move(t,s),a.grid.cells[t][s],a.uiManager.popup.style.display="none"}document.addEventListener("keydown",a=>{we(n,a)});u.addEventListener("click",a=>{const e=u.getBoundingClientRect(),t=a.x-e.left,s=a.y-e.top,o=Math.floor(t/c),i=Math.floor(s/c);n.clickedCell=n.grid.cells[i][o],n.player.move(i,o),n.uiManager.updatePopupUI(n.clickedCell),n.uiManager.popup.style.left=`${a.x+10}px`,n.uiManager.popup.style.top=`${a.y+10}px`,n.uiManager.popup.style.display="block"});const d=document.createElement("div");d.style.position="absolute";d.style.top="10px";d.style.right="10px";d.style.display="flex";d.style.flexDirection="row";d.style.gap="10px";document.body.appendChild(d);g({text:"‚Ü©Ô∏è",div:d,onClick:()=>{n.undo()}});g({text:"‚Ü™Ô∏è",div:d,onClick:()=>{n.redo()}});const U=[{key:"saveGame",text:r("saveGame"),div:d,onClick:()=>{const a=prompt(r("savePrompt"));a&&n.saveToSlot(a)}},{key:"loadGame",text:r("loadGame"),div:d,onClick:()=>{const a=prompt(r("loadPrompt"));a&&n.loadFromSlot(a)}},{key:"listSaveSlots",text:r("listSaveSlots"),div:d,onClick:()=>{n.displaySaveSlots()}},{key:"deleteSaveSlot",text:r("deleteSaveSlot"),div:d,onClick:()=>{const a=prompt(r("deletePrompt"));a&&n.deleteSlot(a)}}],E=[];U.forEach(a=>{const e=g({text:a.text,div:a.div,onClick:a.onClick});E.push(e)});function be(){for(let a=0;a<E.length;a++)E[a].textContent=r(U[a].key)}function xe(){const a=document.createElement("select");[{code:"en",label:"English"},{code:"es",label:"Espa√±ol"},{code:"ar",label:"ÿßŸÑÿπÿ±ÿ®Ÿäÿ©"}].forEach(s=>{const o=document.createElement("option");o.value=s.code,o.textContent=s.label,a.appendChild(o)});const t=localStorage.getItem("language")||"en";a.value=t,L(t),n.uiManager.updateGameUI(),a.addEventListener("change",s=>{const o=s.target.value;L(o),localStorage.setItem("language",o),n.uiManager.updateGameUI(),be(),n.uiManager.createShop()}),document.body.prepend(a)}xe();
